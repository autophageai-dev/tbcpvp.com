{% comment %}TBC Gear Set Builder v2.0 - With Gems & Enchants{% endcomment %}
<div class="tbc-gear-builder" id="tbcGearBuilder">
  <div class="tbc-gb-container">
    <div class="tbc-gb-header">
      <div class="tbc-gb-logo-container"><img src="https://cdn.shopify.com/s/files/1/0964/2609/8968/files/emptybg-processed-tbc20thlogorraw-20251219T060547_1.png?v=1766431386" alt="TBC 20th Anniversary" class="tbc-gb-anniversary-logo"></div>
      <h1 class="tbc-gb-title">{{ section.settings.heading }}</h1>
      <p class="tbc-gb-subtitle">{{ section.settings.subheading }}</p>
      <div class="tbc-gb-season-selector">
        <button class="tbc-gb-season-btn active" data-season="preseason">Pre-Season BiS</button>
        <button class="tbc-gb-season-btn" data-season="season1">Season 1</button>
        <button class="tbc-gb-season-btn" data-season="season2">Season 2</button>
        <button class="tbc-gb-season-btn" data-season="season3">Season 3</button>
        <button class="tbc-gb-season-btn" data-season="season4">Season 4</button>
      </div>
    </div>
    <div class="tbc-gb-main-panel">
      <section class="tbc-gb-section">
        <h2 class="tbc-gb-section-title">Step 1: Select Your Class</h2>
        <div class="tbc-gb-class-grid">
          <button class="tbc-gb-class-btn" data-class="druid"><img src="https://cdn.shopify.com/s/files/1/0964/2609/8968/files/druid.png?v=1766427831" alt="Druid" class="tbc-gb-class-icon"><span class="tbc-gb-class-name">Druid</span></button>
          <button class="tbc-gb-class-btn" data-class="hunter"><img src="https://cdn.shopify.com/s/files/1/0964/2609/8968/files/hunter.png?v=1766427832" alt="Hunter" class="tbc-gb-class-icon"><span class="tbc-gb-class-name">Hunter</span></button>
          <button class="tbc-gb-class-btn" data-class="mage"><img src="https://cdn.shopify.com/s/files/1/0964/2609/8968/files/mage.png?v=1766427831" alt="Mage" class="tbc-gb-class-icon"><span class="tbc-gb-class-name">Mage</span></button>
          <button class="tbc-gb-class-btn" data-class="paladin"><img src="https://cdn.shopify.com/s/files/1/0964/2609/8968/files/pala.png?v=1766427831" alt="Paladin" class="tbc-gb-class-icon"><span class="tbc-gb-class-name">Paladin</span></button>
          <button class="tbc-gb-class-btn" data-class="priest"><img src="https://cdn.shopify.com/s/files/1/0964/2609/8968/files/priest.png?v=1766427831" alt="Priest" class="tbc-gb-class-icon"><span class="tbc-gb-class-name">Priest</span></button>
          <button class="tbc-gb-class-btn" data-class="rogue"><img src="https://cdn.shopify.com/s/files/1/0964/2609/8968/files/rogue.png?v=1766427831" alt="Rogue" class="tbc-gb-class-icon"><span class="tbc-gb-class-name">Rogue</span></button>
          <button class="tbc-gb-class-btn" data-class="shaman"><img src="https://cdn.shopify.com/s/files/1/0964/2609/8968/files/shaman.png?v=1766427831" alt="Shaman" class="tbc-gb-class-icon"><span class="tbc-gb-class-name">Shaman</span></button>
          <button class="tbc-gb-class-btn" data-class="warlock"><img src="https://cdn.shopify.com/s/files/1/0964/2609/8968/files/warlock.png?v=1766427831" alt="Warlock" class="tbc-gb-class-icon"><span class="tbc-gb-class-name">Warlock</span></button>
          <button class="tbc-gb-class-btn" data-class="warrior"><img src="https://cdn.shopify.com/s/files/1/0964/2609/8968/files/war.png?v=1766427831" alt="Warrior" class="tbc-gb-class-icon"><span class="tbc-gb-class-name">Warrior</span></button>
        </div>
      </section>
      <section class="tbc-gb-section" id="tbcSpecSection" style="display:none;">
        <h2 class="tbc-gb-section-title"><span style="font-size:24px;margin-right:10px;">‚öîÔ∏è</span>Step 2: Choose Your Specialization</h2>
        <div class="tbc-gb-spec-grid" id="tbcSpecGrid"></div>
      </section>
      <section class="tbc-gb-section" id="tbcProfessionSection" style="display:none;">
        <h2 class="tbc-gb-section-title"><span style="font-size:24px;margin-right:10px;">‚öíÔ∏è</span>Step 3: Select Your Professions (Optional)</h2>
        <p class="tbc-gb-hint-text">Max 2 professions. Some affect gear choices.</p>
        <div class="tbc-gb-profession-grid">
          <div class="tbc-gb-profession-option" data-profession="blacksmithing"><img src="https://wow.zamimg.com/images/wow/icons/large/trade_blacksmithing.jpg" alt="Blacksmithing" class="tbc-gb-profession-icon"><span class="tbc-gb-profession-name">Blacksmithing</span></div>
          <div class="tbc-gb-profession-option" data-profession="engineering"><img src="https://wow.zamimg.com/images/wow/icons/large/trade_engineering.jpg" alt="Engineering" class="tbc-gb-profession-icon"><span class="tbc-gb-profession-name">Engineering</span></div>
          <div class="tbc-gb-profession-option" data-profession="leatherworking"><img src="https://wow.zamimg.com/images/wow/icons/large/trade_leatherworking.jpg" alt="Leatherworking" class="tbc-gb-profession-icon"><span class="tbc-gb-profession-name">Leatherworking</span></div>
          <div class="tbc-gb-profession-option" data-profession="tailoring"><img src="https://wow.zamimg.com/images/wow/icons/large/trade_tailoring.jpg" alt="Tailoring" class="tbc-gb-profession-icon"><span class="tbc-gb-profession-name">Tailoring</span></div>
          <div class="tbc-gb-profession-option" data-profession="jewelcrafting"><img src="https://wow.zamimg.com/images/wow/icons/large/inv_misc_gem_02.jpg" alt="Jewelcrafting" class="tbc-gb-profession-icon"><span class="tbc-gb-profession-name">Jewelcrafting</span></div>
          <div class="tbc-gb-profession-option" data-profession="enchanting"><img src="https://wow.zamimg.com/images/wow/icons/large/trade_engraving.jpg" alt="Enchanting" class="tbc-gb-profession-icon"><span class="tbc-gb-profession-name">Enchanting</span></div>
          <div class="tbc-gb-profession-option" data-profession="alchemy"><img src="https://wow.zamimg.com/images/wow/icons/large/trade_alchemy.jpg" alt="Alchemy" class="tbc-gb-profession-icon"><span class="tbc-gb-profession-name">Alchemy</span></div>
          <div class="tbc-gb-profession-option" data-profession="none"><div class="tbc-gb-profession-icon-none"><span style="font-size:32px;">‚úï</span></div><span class="tbc-gb-profession-name">No Crafting</span></div>
        </div>
        <div class="tbc-gb-profession-info" id="tbcProfessionInfo" style="display:none;"></div>
      </section>
      <section class="tbc-gb-section" id="tbcBuilderSection" style="display:none;">
        <h2 class="tbc-gb-section-title"><span style="font-size:24px;margin-right:10px;">üõ°Ô∏è</span>Build Your Gear Set</h2>
        <div class="tbc-gb-builder-layout">
          <div class="tbc-gb-gear-column tbc-gb-left-column">
            <div class="tbc-gb-gear-slot" data-slot="head"><div class="tbc-gb-slot-icon"><span>H</span></div><div class="tbc-gb-slot-info"><span class="tbc-gb-slot-label">Head</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="neck"><div class="tbc-gb-slot-icon"><span>N</span></div><div class="tbc-gb-slot-info"><span class="tbc-gb-slot-label">Neck</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="shoulder"><div class="tbc-gb-slot-icon"><span>S</span></div><div class="tbc-gb-slot-info"><span class="tbc-gb-slot-label">Shoulder</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="back"><div class="tbc-gb-slot-icon"><span>B</span></div><div class="tbc-gb-slot-info"><span class="tbc-gb-slot-label">Back</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="chest"><div class="tbc-gb-slot-icon"><span>C</span></div><div class="tbc-gb-slot-info"><span class="tbc-gb-slot-label">Chest</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="wrist"><div class="tbc-gb-slot-icon"><span>Wr</span></div><div class="tbc-gb-slot-info"><span class="tbc-gb-slot-label">Wrist</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div></div>
          </div>
          <div class="tbc-gb-gear-column tbc-gb-center-column">
            <div class="tbc-gb-character-display">
              <div class="tbc-gb-char-icon-wrapper"><img src="https://cdn.shopify.com/s/files/1/0964/2609/8968/files/warlock.png?v=1766427831" alt="Class Icon" id="tbcCharClassIcon" class="tbc-gb-char-class-icon"><div class="tbc-gb-char-glow"></div></div>
              <div class="tbc-gb-char-class" id="tbcCharClass">Select a Class</div>
              <div class="tbc-gb-char-spec" id="tbcCharSpec"></div>
              <div class="tbc-gb-char-season" id="tbcCharSeason">Pre-Season BiS</div>
              <div class="tbc-gb-char-professions" id="tbcCharProfessions"></div>
            </div>
          </div>
          <div class="tbc-gb-gear-column tbc-gb-right-column">
            <div class="tbc-gb-gear-slot" data-slot="hands"><div class="tbc-gb-slot-info right"><span class="tbc-gb-slot-label">Hands</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div><div class="tbc-gb-slot-icon"><span>G</span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="waist"><div class="tbc-gb-slot-info right"><span class="tbc-gb-slot-label">Waist</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div><div class="tbc-gb-slot-icon"><span>W</span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="legs"><div class="tbc-gb-slot-info right"><span class="tbc-gb-slot-label">Legs</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div><div class="tbc-gb-slot-icon"><span>L</span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="feet"><div class="tbc-gb-slot-info right"><span class="tbc-gb-slot-label">Feet</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div><div class="tbc-gb-slot-icon"><span>F</span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="ring1"><div class="tbc-gb-slot-info right"><span class="tbc-gb-slot-label">Ring 1</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div><div class="tbc-gb-slot-icon"><span>R1</span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="ring2"><div class="tbc-gb-slot-info right"><span class="tbc-gb-slot-label">Ring 2</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div><div class="tbc-gb-slot-icon"><span>R2</span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="trinket1"><div class="tbc-gb-slot-info right"><span class="tbc-gb-slot-label">Trinket 1</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div><div class="tbc-gb-slot-icon"><span>T1</span></div></div>
            <div class="tbc-gb-gear-slot" data-slot="trinket2"><div class="tbc-gb-slot-info right"><span class="tbc-gb-slot-label">Trinket 2</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div><div class="tbc-gb-slot-icon"><span>T2</span></div></div>
          </div>
        </div>
        <div class="tbc-gb-weapons-row">
          <div class="tbc-gb-gear-slot weapon-slot" data-slot="mainhand"><div class="tbc-gb-slot-icon"><span>MH</span></div><div class="tbc-gb-slot-info"><span class="tbc-gb-slot-label">Main Hand</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div></div>
          <div class="tbc-gb-gear-slot weapon-slot" data-slot="offhand"><div class="tbc-gb-slot-icon"><span>OH</span></div><div class="tbc-gb-slot-info"><span class="tbc-gb-slot-label">Off Hand</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div></div>
          <div class="tbc-gb-gear-slot weapon-slot" data-slot="ranged"><div class="tbc-gb-slot-icon"><span>Ra</span></div><div class="tbc-gb-slot-info"><span class="tbc-gb-slot-label">Ranged/Relic</span><span class="tbc-gb-item-name empty">Click to add item</span><span class="tbc-gb-slot-extras"></span></div></div>
        </div>
        <div class="tbc-gb-actions">
          <input type="text" class="tbc-gb-input tbc-gb-set-name-input" id="tbcSetNameInput" placeholder="Enter gear set name...">
          <button class="tbc-gb-btn tbc-gb-btn-primary" id="tbcSaveSetBtn"><span>üíæ</span> SAVE SET</button>
          <button class="tbc-gb-btn tbc-gb-btn-secondary" id="tbcClearAllBtn"><span>üóëÔ∏è</span> CLEAR ALL</button>
          <button class="tbc-gb-btn tbc-gb-btn-secondary" id="tbcShareSetBtn"><span>üîó</span> COPY SHARE LINK</button>
        </div>
      </section>
      <section class="tbc-gb-section">
        <h2 class="tbc-gb-section-title"><span style="font-size:24px;margin-right:10px;">üìÅ</span>Saved Gear Sets</h2>
        <div class="tbc-gb-saved-list" id="tbcSavedSetsList"><p class="tbc-gb-empty-message">No saved gear sets yet.</p></div>
      </section>
      <div class="tbc-gb-footer">
        <span class="tbc-gb-autosave-indicator" id="tbcAutosaveIndicator">Auto-saved</span>
        <button class="tbc-gb-reset-btn" id="tbcResetAllBtn">Reset All Data</button>
      </div>
    </div>
  </div>
  <div class="tbc-gb-modal-overlay" id="tbcModalOverlay">
    <div class="tbc-gb-modal">
      <h3 class="tbc-gb-modal-title" id="tbcModalTitle">Add Item - Head</h3>
      <div class="tbc-gb-modal-field"><label class="tbc-gb-modal-label">WOWHEAD ITEM ID OR URL</label><input type="text" class="tbc-gb-input" id="tbcItemIdInput" placeholder="e.g. 35329 or https://tbc.wowhead.com/item=35329"></div>
      <p class="tbc-gb-modal-hint">Find items on <a href="https://tbc.wowhead.com" target="_blank" rel="noopener">tbc.wowhead.com</a></p>
      <div class="tbc-gb-modal-field"><label class="tbc-gb-modal-label">ITEM QUALITY</label><div class="tbc-gb-select-wrapper"><select class="tbc-gb-select" id="tbcItemQualitySelect"><option value="2">Uncommon (Green)</option><option value="3">Rare (Blue)</option><option value="4" selected>Epic (Purple)</option><option value="5">Legendary (Orange)</option></select></div></div>
      <div class="tbc-gb-modal-divider"></div>
      <div class="tbc-gb-modal-field" id="tbcGemSection">
        <label class="tbc-gb-modal-label">üíé GEMS (Item IDs)</label>
        <div class="tbc-gb-gem-row">
          <div class="tbc-gb-gem-input-wrap"><span class="tbc-gb-gem-label meta">Meta</span><input type="text" class="tbc-gb-input tbc-gb-gem-input" id="tbcMetaGem" placeholder="e.g. 32409"></div>
        </div>
        <div class="tbc-gb-gem-row">
          <div class="tbc-gb-gem-input-wrap"><span class="tbc-gb-gem-label red">Red</span><input type="text" class="tbc-gb-input tbc-gb-gem-input" id="tbcGem1" placeholder="Item ID"></div>
          <div class="tbc-gb-gem-input-wrap"><span class="tbc-gb-gem-label yellow">Yellow</span><input type="text" class="tbc-gb-input tbc-gb-gem-input" id="tbcGem2" placeholder="Item ID"></div>
          <div class="tbc-gb-gem-input-wrap"><span class="tbc-gb-gem-label blue">Blue</span><input type="text" class="tbc-gb-input tbc-gb-gem-input" id="tbcGem3" placeholder="Item ID"></div>
        </div>
      </div>
      <div class="tbc-gb-modal-field"><label class="tbc-gb-modal-label">‚ú® ENCHANT (Item/Spell ID)</label><input type="text" class="tbc-gb-input" id="tbcEnchantInput" placeholder="e.g. 35452 or spell ID"></div>
      <div class="tbc-gb-modal-actions"><button class="tbc-gb-btn tbc-gb-btn-danger" id="tbcRemoveItemBtn">REMOVE</button><button class="tbc-gb-btn tbc-gb-btn-secondary" id="tbcCancelModalBtn">CANCEL</button><button class="tbc-gb-btn tbc-gb-btn-primary" id="tbcSaveItemBtn">SAVE</button></div>
    </div>
  </div>
</div>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
* { margin: 0; padding: 0; box-sizing: border-box; }
.tbc-gear-builder { width: 100%; background: #000; color: #fff; font-family: 'Inter', sans-serif; padding: 60px 20px; min-height: 100vh; }
.tbc-gb-container { max-width: 1200px; margin: 0 auto; }
.tbc-gb-header { text-align: center; margin-bottom: 50px; padding: 50px 30px; background: linear-gradient(180deg, rgba(0,0,0,0.85), rgba(0,0,0,0.95)), url('https://wow.zamimg.com/uploads/screenshots/normal/314937-blades-edge-arena.jpg'); background-size: cover; background-position: center; border-bottom: 2px solid #00FF41; border-radius: 12px 12px 0 0; position: relative; overflow: hidden; }
.tbc-gb-header::before { content: ''; position: absolute; top: 0; left: -100%; width: 200%; height: 100%; background: linear-gradient(90deg, transparent, rgba(0,255,65,0.03), transparent); animation: shimmer 8s linear infinite; }
@keyframes shimmer { 0% { transform: translateX(0); } 100% { transform: translateX(50%); } }
.tbc-gb-logo-container { margin-bottom: 20px; position: relative; z-index: 1; }
.tbc-gb-anniversary-logo { max-width: 350px; height: auto; filter: drop-shadow(0 0 20px rgba(0,255,65,0.3)); }
.tbc-gb-title { font-size: 42px; font-weight: 700; letter-spacing: 2px; margin-bottom: 12px; color: #00FF41; text-shadow: 0 0 20px rgba(0,255,65,0.5); position: relative; z-index: 1; }
.tbc-gb-subtitle { font-size: 16px; color: rgba(255,255,255,0.6); position: relative; z-index: 1; margin-bottom: 30px; }
.tbc-gb-season-selector { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; position: relative; z-index: 1; }
.tbc-gb-season-btn { padding: 12px 24px; background: transparent; border: 1px solid rgba(0,255,65,0.3); color: rgba(255,255,255,0.7); font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; border-radius: 6px; }
.tbc-gb-season-btn:hover { background: rgba(0,255,65,0.05); border-color: #00FF41; color: #00FF41; }
.tbc-gb-season-btn.active { background: #00FF41; color: #000; border-color: #00FF41; }
.tbc-gb-main-panel { background: rgba(13,27,13,0.2); border: 1px solid rgba(0,255,65,0.2); border-radius: 12px; padding: 40px; }
.tbc-gb-section { margin-bottom: 40px; padding-bottom: 40px; border-bottom: 1px solid rgba(0,255,65,0.1); }
.tbc-gb-section:last-of-type { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
.tbc-gb-section-title { font-size: 20px; font-weight: 600; margin-bottom: 25px; color: #00FF41; display: flex; align-items: center; }
.tbc-gb-hint-text { color: rgba(255,255,255,0.6); font-size: 13px; margin-bottom: 20px; }
.tbc-gb-class-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
.tbc-gb-class-grid .tbc-gb-class-btn:nth-child(5) { grid-column: 1; }
.tbc-gb-class-btn { padding: 20px; background: rgba(0,0,0,0.4); border: 1px solid rgba(0,255,65,0.2); color: rgba(255,255,255,0.8); font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.25s cubic-bezier(0.4,0,0.2,1); border-radius: 8px; display: flex; flex-direction: column; align-items: center; gap: 10px; }
.tbc-gb-class-btn:hover { background: rgba(0,255,65,0.1); border-color: #00FF41; color: #00FF41; transform: translateY(-3px) scale(1.03); box-shadow: 0 4px 12px rgba(0,255,65,0.2); }
.tbc-gb-class-btn.selected { background: rgba(0,255,65,0.2); border-color: #00FF41; color: #00FF41; box-shadow: 0 0 25px rgba(0,255,65,0.4), inset 0 0 15px rgba(0,255,65,0.1); }
.tbc-gb-class-icon { width: 40px; height: 40px; object-fit: contain; filter: brightness(0.9); transition: filter 0.2s; }
.tbc-gb-class-btn:hover .tbc-gb-class-icon { filter: brightness(1.1) drop-shadow(0 0 8px rgba(0,255,65,0.5)); }
.tbc-gb-class-btn.selected .tbc-gb-class-icon { filter: brightness(1.2) drop-shadow(0 0 12px rgba(0,255,65,0.8)); }
.tbc-gb-class-name { font-size: 13px; }
.tbc-gb-spec-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
.tbc-gb-spec-option { background: linear-gradient(145deg, rgba(0,0,0,0.7), rgba(0,0,0,0.5)); border: 2px solid rgba(255,255,255,0.15); border-radius: 12px; padding: 24px 20px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4,0,0.2,1); text-align: center; display: flex; flex-direction: column; align-items: center; gap: 12px; }
.tbc-gb-spec-option:hover { border-color: rgba(0,255,65,0.7); background: linear-gradient(145deg, rgba(0,255,65,0.15), rgba(0,0,0,0.6)); transform: translateY(-4px) scale(1.03); box-shadow: 0 8px 24px rgba(0,255,65,0.3); }
.tbc-gb-spec-option.selected { border-color: #00FF41; background: linear-gradient(145deg, rgba(0,255,65,0.25), rgba(0,0,0,0.7)); box-shadow: 0 0 30px rgba(0,255,65,0.6), inset 0 0 25px rgba(0,255,65,0.15); }
.tbc-gb-spec-icon { width: 64px; height: 64px; border-radius: 10px; border: 3px solid rgba(255,255,255,0.25); box-shadow: 0 4px 12px rgba(0,0,0,0.4); transition: all 0.3s; }
.tbc-gb-spec-option:hover .tbc-gb-spec-icon { border-color: rgba(0,255,65,0.6); box-shadow: 0 6px 20px rgba(0,255,65,0.3); transform: scale(1.08); }
.tbc-gb-spec-option.selected .tbc-gb-spec-icon { border-color: #00FF41; box-shadow: 0 0 20px rgba(0,255,65,0.6); }
.tbc-gb-spec-name { font-size: 16px; font-weight: 700; color: #00FF41; text-transform: uppercase; }
.tbc-gb-spec-desc { font-size: 12px; color: rgba(255,255,255,0.65); }
.tbc-gb-profession-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; }
.tbc-gb-profession-option { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 15px; background: rgba(0,0,0,0.3); border: 2px solid rgba(0,255,65,0.2); border-radius: 8px; cursor: pointer; transition: all 0.25s cubic-bezier(0.4,0,0.2,1); }
.tbc-gb-profession-option:hover { background: rgba(0,255,65,0.1); border-color: #00FF41; transform: translateY(-3px) scale(1.02); box-shadow: 0 4px 12px rgba(0,255,65,0.2); }
.tbc-gb-profession-option.selected { background: rgba(0,255,65,0.2); border-color: #00FF41; box-shadow: 0 0 25px rgba(0,255,65,0.4), inset 0 0 20px rgba(0,255,65,0.1); }
.tbc-gb-profession-icon { width: 56px; height: 56px; border-radius: 6px; border: 2px solid rgba(0,255,65,0.3); }
.tbc-gb-profession-icon-none { width: 56px; height: 56px; border-radius: 6px; border: 2px solid rgba(255,255,255,0.3); background: rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; color: rgba(255,255,255,0.5); }
.tbc-gb-profession-name { font-size: 13px; font-weight: 600; color: rgba(255,255,255,0.9); text-align: center; }
.tbc-gb-profession-info { margin-top: 20px; padding: 15px; background: rgba(0,255,65,0.05); border: 1px solid rgba(0,255,65,0.2); border-radius: 6px; }
.tbc-gb-profession-info p { font-size: 13px; color: rgba(255,255,255,0.8); line-height: 1.6; margin-bottom: 10px; }
.tbc-gb-profession-info p:last-child { margin-bottom: 0; }
.tbc-gb-profession-info strong { color: #00FF41; }
.tbc-gb-builder-layout { display: grid; grid-template-columns: 1fr 260px 1fr; gap: 20px; margin-bottom: 30px; }
.tbc-gb-gear-column { display: flex; flex-direction: column; gap: 10px; }
.tbc-gb-left-column { align-items: flex-end; }
.tbc-gb-right-column { align-items: flex-start; }
.tbc-gb-center-column { display: flex; align-items: center; justify-content: center; }
.tbc-gb-character-display { background: linear-gradient(180deg, rgba(0,255,65,0.05), rgba(0,0,0,0.8)); border: 1px solid rgba(0,255,65,0.2); border-radius: 16px; padding: 40px 30px; text-align: center; width: 100%; min-height: 400px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 0 0 40px rgba(0,0,0,0.5), inset 0 0 60px rgba(0,255,65,0.03); }
.tbc-gb-char-icon-wrapper { position: relative; width: 100px; height: 100px; margin-bottom: 20px; }
.tbc-gb-char-class-icon { width: 100%; height: 100%; object-fit: contain; position: relative; z-index: 2; filter: drop-shadow(0 0 15px rgba(0,255,65,0.4)); transition: all 0.3s; }
.tbc-gb-char-glow { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 130px; height: 130px; background: radial-gradient(circle, rgba(0,255,65,0.4), transparent 70%); border-radius: 50%; z-index: 1; animation: pulse 2s ease-in-out infinite; }
@keyframes pulse { 0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); } 50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.1); } }
.tbc-gb-char-class { font-size: 1.6rem; font-weight: 700; text-transform: uppercase; letter-spacing: 3px; margin-bottom: 8px; text-shadow: 0 0 20px currentColor; }
.tbc-gb-char-spec { font-size: 15px; color: #00FF41; margin-bottom: 8px; font-weight: 500; }
.tbc-gb-char-season { color: rgba(255,255,255,0.6); font-size: 13px; margin-bottom: 15px; }
.tbc-gb-char-professions { font-size: 12px; color: rgba(255,255,255,0.5); }
.class-druid { color: #ff7d0a !important; } .class-hunter { color: #abd473 !important; } .class-mage { color: #69ccf0 !important; } .class-paladin { color: #f58cba !important; } .class-priest { color: #fff !important; } .class-rogue { color: #fff569 !important; } .class-shaman { color: #0070de !important; } .class-warlock { color: #9482c9 !important; } .class-warrior { color: #c79c6e !important; }
.tbc-gb-gear-slot { display: flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #111, #000); border: 1px solid rgba(0,255,65,0.2); border-radius: 10px; padding: 12px 16px; cursor: pointer; transition: all 0.3s; min-width: 220px; position: relative; overflow: hidden; }
.tbc-gb-gear-slot::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, transparent, rgba(0,255,65,0.1)); opacity: 0; transition: opacity 0.3s; }
.tbc-gb-gear-slot:hover { border-color: #00FF41; box-shadow: 0 0 20px rgba(0,255,65,0.4), 0 0 40px rgba(0,255,65,0.15), inset 0 0 20px rgba(0,255,65,0.05); transform: translateY(-3px) scale(1.02); }
.tbc-gb-gear-slot:hover::before { opacity: 1; }
.tbc-gb-gear-slot.has-item { border-color: #333; background: linear-gradient(135deg, #151515, #0a0a0a); }
.tbc-gb-gear-slot.has-item:hover { border-color: #00FF41; }
.tbc-gb-slot-icon { width: 44px; height: 44px; background: linear-gradient(135deg, #1a1a1a, #0d0d0d); border: 2px solid #2a2a2a; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 600; color: rgba(255,255,255,0.5); flex-shrink: 0; position: relative; z-index: 1; transition: all 0.3s; overflow: hidden; }
.tbc-gb-gear-slot:hover .tbc-gb-slot-icon { border-color: #00FF41; box-shadow: 0 0 10px rgba(0,255,65,0.4); }
.tbc-gb-slot-icon img { width: 100%; height: 100%; border-radius: 6px; object-fit: cover; }
.tbc-gb-slot-icon a { display: block; width: 100%; height: 100%; }
.tbc-gb-slot-icon .tbc-gb-icon-link { font-size: 0; color: transparent; overflow: hidden; }
.tbc-gb-slot-icon .iconmedium { margin: 0 !important; }
.tbc-gb-slot-icon .iconmedium ins { width: 40px !important; height: 40px !important; border-radius: 6px; }
.tbc-gb-slot-icon .iconmedium del { display: none !important; }
.tbc-gb-item-name .iconmedium, .tbc-gb-item-name .iconsmall { display: none !important; }
.tbc-gb-slot-info { display: flex; flex-direction: column; gap: 2px; overflow: hidden; position: relative; z-index: 1; flex: 1; }
.tbc-gb-slot-info.right { text-align: right; }
.tbc-gb-slot-label { font-size: 0.7rem; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px; }
.tbc-gb-item-name { font-size: 0.85rem; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.tbc-gb-item-name.empty { color: rgba(255,255,255,0.4); font-style: italic; }
.tbc-gb-item-name.q2, .tbc-gb-item-name.q2 a { color: #1eff00 !important; }
.tbc-gb-item-name.q3, .tbc-gb-item-name.q3 a { color: #0070dd !important; }
.tbc-gb-item-name.q4, .tbc-gb-item-name.q4 a { color: #a335ee !important; }
.tbc-gb-item-name.q5, .tbc-gb-item-name.q5 a { color: #ff8000 !important; }
.tbc-gb-item-name a { text-decoration: none !important; transition: text-shadow 0.2s; }
.tbc-gb-item-name a:hover { text-shadow: 0 0 8px currentColor; }
.tbc-gb-slot-extras { font-size: 0.7rem; color: rgba(255,255,255,0.5); display: flex; gap: 6px; flex-wrap: wrap; margin-top: 2px; }
.tbc-gb-slot-extras a { text-decoration: none !important; }
.tbc-gb-slot-extras .iconsmall, .tbc-gb-slot-extras .icontiny { margin: 0 !important; display: inline-block !important; vertical-align: middle; }
.tbc-gb-slot-extras .iconsmall ins, .tbc-gb-slot-extras .icontiny ins { width: 16px !important; height: 16px !important; border-radius: 3px; }
.tbc-gb-slot-extras .iconsmall del, .tbc-gb-slot-extras .icontiny del { display: none !important; }
.tbc-gb-enchant-text { color: #1eff00; font-size: 0.65rem; }
.tbc-gb-weapons-row { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; padding-top: 30px; border-top: 1px solid rgba(0,255,65,0.1); margin-bottom: 30px; }
.tbc-gb-gear-slot.weapon-slot { min-width: 200px; }
.tbc-gb-actions { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; padding: 30px 0; border-top: 1px solid rgba(0,255,65,0.1); }
.tbc-gb-input { background: #000; border: 1px solid rgba(0,255,65,0.2); border-radius: 8px; padding: 14px 16px; color: #fff; font-size: 1rem; font-family: 'Inter', sans-serif; transition: all 0.3s; width: 100%; }
.tbc-gb-input:focus { outline: none; border-color: #00FF41; box-shadow: 0 0 0 3px rgba(0,255,65,0.4), 0 0 20px rgba(0,255,65,0.4); }
.tbc-gb-input::placeholder { color: rgba(255,255,255,0.4); }
.tbc-gb-set-name-input { width: 240px; }
.tbc-gb-btn { padding: 14px 28px; border: none; border-radius: 8px; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1.5px; cursor: pointer; transition: all 0.3s; font-family: 'Inter', sans-serif; display: flex; align-items: center; gap: 8px; }
.tbc-gb-btn-primary { background: linear-gradient(135deg, #00FF41, #00cc33); color: #000; box-shadow: 0 0 20px rgba(0,255,65,0.3); }
.tbc-gb-btn-primary:hover { box-shadow: 0 0 30px rgba(0,255,65,0.5), 0 0 60px rgba(0,255,65,0.3); transform: translateY(-2px); }
.tbc-gb-btn-secondary { background: transparent; border: 1px solid rgba(0,255,65,0.2); color: #fff; }
.tbc-gb-btn-secondary:hover { border-color: #00FF41; color: #00FF41; box-shadow: 0 0 15px rgba(0,255,65,0.4); transform: translateY(-2px); }
.tbc-gb-btn-danger { background: linear-gradient(135deg, #ff4444, #cc3333); color: #fff; }
.tbc-gb-btn-danger:hover { box-shadow: 0 0 20px rgba(255,68,68,0.4); transform: translateY(-2px); }
.tbc-gb-saved-list { display: flex; flex-direction: column; gap: 10px; }
.tbc-gb-saved-item { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: linear-gradient(135deg, #111, #000); border: 1px solid rgba(0,255,65,0.2); border-radius: 10px; transition: all 0.3s; }
.tbc-gb-saved-item:hover { border-color: #333; box-shadow: 0 0 15px rgba(0,0,0,0.3); }
.tbc-gb-saved-info { display: flex; flex-direction: column; gap: 4px; }
.tbc-gb-saved-name { color: #fff; font-weight: 600; font-size: 15px; }
.tbc-gb-saved-meta { font-size: 12px; color: rgba(255,255,255,0.5); }
.tbc-gb-saved-actions { display: flex; gap: 10px; }
.tbc-gb-saved-actions .tbc-gb-btn { padding: 10px 18px; font-size: 0.75rem; }
.tbc-gb-empty-message { color: rgba(255,255,255,0.5); font-size: 14px; text-align: center; padding: 30px; }
.tbc-gb-footer { display: flex; justify-content: space-between; align-items: center; padding-top: 30px; margin-top: 30px; border-top: 1px solid rgba(0,255,65,0.1); }
.tbc-gb-autosave-indicator { font-size: 13px; font-weight: 600; color: rgba(255,255,255,0.4); }
.tbc-gb-reset-btn { padding: 10px 20px; background: transparent; border: 1px solid rgba(255,68,68,0.3); color: rgba(255,68,68,0.7); font-family: 'Inter', sans-serif; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; border-radius: 6px; }
.tbc-gb-reset-btn:hover { background: rgba(255,68,68,0.1); border-color: #FF4444; color: #FF4444; }
.tbc-gb-modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; justify-content: center; align-items: center; padding: 20px; backdrop-filter: blur(5px); }
.tbc-gb-modal-overlay.active { display: flex; }
.tbc-gb-modal { background: linear-gradient(180deg, #0d0d0d, #000); border: 1px solid #00FF41; border-radius: 16px; padding: 35px; max-width: 500px; width: 100%; box-shadow: 0 0 60px rgba(0,255,65,0.4); position: relative; max-height: 90vh; overflow-y: auto; }
.tbc-gb-modal::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, #00FF41, transparent); }
.tbc-gb-modal-title { color: #00FF41; font-size: 1.4rem; font-weight: 600; margin: 0 0 28px 0; text-shadow: 0 0 15px rgba(0,255,65,0.4); }
.tbc-gb-modal-field { margin-bottom: 20px; }
.tbc-gb-modal-label { font-size: 0.75rem; font-weight: 600; color: #00FF41; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 10px; }
.tbc-gb-modal-hint { font-size: 0.85rem; color: rgba(255,255,255,0.5); margin: 0 0 20px 0; }
.tbc-gb-modal-hint a { color: #00FF41; text-decoration: none; }
.tbc-gb-modal-hint a:hover { text-shadow: 0 0 10px rgba(0,255,65,0.4); }
.tbc-gb-modal-divider { height: 1px; background: rgba(0,255,65,0.2); margin: 25px 0; }
.tbc-gb-gem-row { display: flex; gap: 10px; margin-bottom: 10px; }
.tbc-gb-gem-input-wrap { flex: 1; position: relative; }
.tbc-gb-gem-input { padding-left: 50px !important; font-size: 0.85rem !important; }
.tbc-gb-gem-label { position: absolute; left: 8px; top: 50%; transform: translateY(-50%); font-size: 0.65rem; font-weight: 700; text-transform: uppercase; padding: 2px 6px; border-radius: 3px; z-index: 1; }
.tbc-gb-gem-label.meta { background: #666; color: #fff; }
.tbc-gb-gem-label.red { background: #ff4444; color: #fff; }
.tbc-gb-gem-label.yellow { background: #ffcc00; color: #000; }
.tbc-gb-gem-label.blue { background: #4444ff; color: #fff; }
.tbc-gb-select-wrapper { position: relative; }
.tbc-gb-select { width: 100%; background: #000; border: 1px solid rgba(0,255,65,0.2); border-radius: 8px; padding: 14px 16px; color: #fff; font-size: 1rem; font-family: 'Inter', sans-serif; appearance: none; cursor: pointer; transition: all 0.3s; }
.tbc-gb-select:focus { outline: none; border-color: #00FF41; box-shadow: 0 0 0 3px rgba(0,255,65,0.4); }
.tbc-gb-select option { background: #000; color: #fff; }
.tbc-gb-modal-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 28px; }
@media (max-width: 1024px) { .tbc-gb-class-grid { grid-template-columns: repeat(3, 1fr); } .tbc-gb-class-grid .tbc-gb-class-btn:nth-child(5) { grid-column: auto; } .tbc-gb-anniversary-logo { max-width: 280px; } .tbc-gb-title { font-size: 32px; } }
@media (max-width: 900px) { .tbc-gb-builder-layout { grid-template-columns: 1fr; gap: 20px; } .tbc-gb-left-column, .tbc-gb-right-column { align-items: stretch; } .tbc-gb-center-column { order: -1; } .tbc-gb-gear-slot { min-width: 100%; } }
@media (max-width: 768px) { .tbc-gear-builder { padding: 20px 10px; } .tbc-gb-main-panel { padding: 20px 15px; } .tbc-gb-header { padding: 30px 15px; } .tbc-gb-title { font-size: 24px; } .tbc-gb-season-btn { padding: 10px 18px; font-size: 13px; } .tbc-gb-class-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; } .tbc-gb-class-btn { padding: 15px 10px; } .tbc-gb-class-icon { width: 32px; height: 32px; } .tbc-gb-profession-grid { grid-template-columns: repeat(2, 1fr); } .tbc-gb-actions { flex-direction: column; align-items: stretch; } .tbc-gb-set-name-input { width: 100%; } .tbc-gb-weapons-row { flex-direction: column; } .tbc-gb-gear-slot.weapon-slot { min-width: 100%; } .tbc-gb-footer { flex-direction: column; gap: 15px; } .tbc-gb-modal { padding: 25px; } .tbc-gb-modal-actions { flex-direction: column; } .tbc-gb-gem-row { flex-direction: column; } }
</style>

<script>const whTooltips={colorLinks:false,iconizeLinks:true,iconSize:'medium',renameLinks:true};</script>
<script src="https://wow.zamimg.com/js/tooltips.js"></script>
<script>
(function() {
  'use strict';

  const CLASS_SPECS = {
    warrior: [{id:'arms',name:'Arms',icon:'ability_warrior_savageblow.jpg',desc:'META - Mortal Strike'},{id:'fury',name:'Fury',icon:'ability_warrior_innerrage.jpg',desc:'Dual wield burst'}],
    paladin: [{id:'holy',name:'Holy',icon:'spell_holy_holybolt.jpg',desc:'Healer'},{id:'ret',name:'Retribution',icon:'spell_holy_crusaderstrike.jpg',desc:'Melee DPS'}],
    hunter: [{id:'survival',name:'Survival',icon:'ability_hunter_swiftstrike.jpg',desc:'META arena'},{id:'bm',name:'Beast Mastery',icon:'ability_hunter_beasttaming.jpg',desc:'Pet burst'},{id:'mm',name:'Marksmanship',icon:'ability_marksmanship.jpg',desc:'Ranged DPS'}],
    rogue: [{id:'subtlety',name:'Subtlety',icon:'ability_stealth.jpg',desc:'META - Shadowstep'},{id:'mutilate',name:'Mutilate',icon:'ability_rogue_shadowstrikes.jpg',desc:'Dagger spec'}],
    priest: [{id:'disc',name:'Discipline',icon:'spell_holy_wordfortitude.jpg',desc:'META healer'},{id:'shadow',name:'Shadow',icon:'spell_shadow_shadowwordpain.jpg',desc:'DPS'},{id:'holy',name:'Holy',icon:'spell_holy_guardianspirit.jpg',desc:'Pure healing'}],
    shaman: [{id:'resto',name:'Restoration',icon:'spell_nature_magicimmunity.jpg',desc:'META healer'},{id:'enhancement',name:'Enhancement',icon:'spell_nature_lightningshield.jpg',desc:'Melee DPS'},{id:'elemental',name:'Elemental',icon:'spell_lightning_lightningbolt01.jpg',desc:'Burst caster'}],
    mage: [{id:'frost',name:'Frost',icon:'spell_frost_frostbolt02.jpg',desc:'META control'},{id:'fire',name:'Fire',icon:'spell_fire_firebolt02.jpg',desc:'Burst'},{id:'arcane',name:'Arcane',icon:'spell_holy_magicalsentry.jpg',desc:'Arcane power'}],
    warlock: [{id:'slsl',name:'SL/SL',icon:'spell_shadow_gathershadows.jpg',desc:'META tanky'},{id:'affliction',name:'Affliction',icon:'spell_shadow_unstableaffliction_3.jpg',desc:'DoTs'},{id:'destruction',name:'Destruction',icon:'spell_shadow_rainoffire.jpg',desc:'Burst'}],
    druid: [{id:'resto',name:'Restoration',icon:'spell_nature_healingtouch.jpg',desc:'HoT healer'},{id:'feral',name:'Feral',icon:'classic_ability_druid_demoralizingroar.jpg',desc:'Melee DPS'},{id:'balance',name:'Balance',icon:'spell_nature_starfall.jpg',desc:'Caster DPS'}]
  };
  const CLASS_ICONS = {druid:'https://cdn.shopify.com/s/files/1/0964/2609/8968/files/druid.png?v=1766427831',hunter:'https://cdn.shopify.com/s/files/1/0964/2609/8968/files/hunter.png?v=1766427832',mage:'https://cdn.shopify.com/s/files/1/0964/2609/8968/files/mage.png?v=1766427831',paladin:'https://cdn.shopify.com/s/files/1/0964/2609/8968/files/pala.png?v=1766427831',priest:'https://cdn.shopify.com/s/files/1/0964/2609/8968/files/priest.png?v=1766427831',rogue:'https://cdn.shopify.com/s/files/1/0964/2609/8968/files/rogue.png?v=1766427831',shaman:'https://cdn.shopify.com/s/files/1/0964/2609/8968/files/shaman.png?v=1766427831',warlock:'https://cdn.shopify.com/s/files/1/0964/2609/8968/files/warlock.png?v=1766427831',warrior:'https://cdn.shopify.com/s/files/1/0964/2609/8968/files/war.png?v=1766427831'};
  const SEASON_LABELS = {preseason:'Pre-Season BiS',season1:'Season 1',season2:'Season 2',season3:'Season 3',season4:'Season 4'};
  const SLOT_LABELS = {head:'H',neck:'N',shoulder:'S',back:'B',chest:'C',wrist:'Wr',hands:'G',waist:'W',legs:'L',feet:'F',ring1:'R1',ring2:'R2',trinket1:'T1',trinket2:'T2',mainhand:'MH',offhand:'OH',ranged:'Ra'};
  const SLOT_NAMES = {head:'Head',neck:'Neck',shoulder:'Shoulder',back:'Back',chest:'Chest',wrist:'Wrist',hands:'Hands',waist:'Waist',legs:'Legs',feet:'Feet',ring1:'Ring 1',ring2:'Ring 2',trinket1:'Trinket 1',trinket2:'Trinket 2',mainhand:'Main Hand',offhand:'Off Hand',ranged:'Ranged/Relic'};
  const ENCHANTABLE_SLOTS = ['head','shoulder','back','chest','wrist','hands','legs','feet','mainhand','offhand'];
  const GEM_SLOTS = ['head','neck','shoulder','chest','wrist','hands','waist','legs','feet','ring1','ring2','mainhand','offhand'];
  const PROFESSION_INFO = {blacksmithing:'<strong>Blacksmithing:</strong> Craft Dragonmaw, Stormherald.',engineering:'<strong>Engineering:</strong> Craft goggles.',leatherworking:'<strong>Leatherworking:</strong> Windhawk/Primalstrike sets.',tailoring:'<strong>Tailoring:</strong> Spellstrike/Frozen Shadoweave.',jewelcrafting:'<strong>Jewelcrafting:</strong> Superior gems.',enchanting:'<strong>Enchanting:</strong> Ring enchants.',alchemy:'<strong>Alchemy:</strong> Alchemist Stone.'};

  let state = {season:'preseason',selectedClass:null,selectedSpec:null,professions:[],gearData:{}};
  let currentSlot = null;

  function init() {
    loadState();
    bindEvents();
    renderSavedSets();
    updateCharacterDisplay();
    observeWowheadChanges();
  }

  function observeWowheadChanges() {
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'childList' || mutation.type === 'characterData') {
          document.querySelectorAll('.tbc-gb-item-name a').forEach(function(link) {
            const text = link.textContent || link.innerText;
            if (text && !text.includes('Item #') && link.dataset.renamed !== 'true') {
              link.dataset.renamed = 'true';
              const slot = link.closest('.tbc-gb-gear-slot')?.dataset.slot;
              if (slot && state.gearData[slot]) {
                state.gearData[slot].name = text;
                saveState();
              }
            }
          });
        }
      });
    });
    observer.observe(document.getElementById('tbcGearBuilder'), { childList: true, subtree: true, characterData: true });
  }

  function bindEvents() {
    document.querySelectorAll('.tbc-gb-season-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        state.season = this.dataset.season;
        document.querySelectorAll('.tbc-gb-season-btn').forEach(function(b) { b.classList.remove('active'); });
        this.classList.add('active');
        updateCharacterDisplay();
        saveState();
      });
    });

    document.querySelectorAll('.tbc-gb-class-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        var newClass = this.dataset.class;
        if (newClass === state.selectedClass) return;
        state.selectedClass = newClass;
        state.selectedSpec = null;
        state.professions = [];
        document.querySelectorAll('.tbc-gb-class-btn').forEach(function(b) { b.classList.remove('selected'); });
        this.classList.add('selected');
        renderSpecSelection();
        document.getElementById('tbcProfessionSection').style.display = 'none';
        document.getElementById('tbcBuilderSection').style.display = 'none';
        document.querySelectorAll('.tbc-gb-profession-option').forEach(function(o) { o.classList.remove('selected'); });
        updateCharacterDisplay();
        saveState();
      });
    });

    document.querySelectorAll('.tbc-gb-profession-option').forEach(function(opt) {
      opt.addEventListener('click', function() {
        var profession = this.dataset.profession;
        if (profession === 'none') {
          state.professions = [];
          document.querySelectorAll('.tbc-gb-profession-option').forEach(function(o) { o.classList.remove('selected'); });
        } else {
          var isSelected = this.classList.contains('selected');
          if (isSelected) {
            this.classList.remove('selected');
            state.professions = state.professions.filter(function(p) { return p !== profession; });
          } else {
            if (state.professions.length >= 2) return;
            this.classList.add('selected');
            state.professions.push(profession);
          }
        }
        updateProfessionInfo();
        updateCharacterDisplay();
        saveState();
      });
    });

    document.querySelectorAll('.tbc-gb-gear-slot').forEach(function(slot) {
      slot.addEventListener('click', function(e) {
        if (!e.target.closest('a')) openSlotModal(this.dataset.slot);
      });
    });

    document.getElementById('tbcModalOverlay').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });
    document.getElementById('tbcItemIdInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') saveItem();
    });
    document.getElementById('tbcSaveItemBtn').addEventListener('click', saveItem);
    document.getElementById('tbcRemoveItemBtn').addEventListener('click', removeItem);
    document.getElementById('tbcCancelModalBtn').addEventListener('click', closeModal);
    document.getElementById('tbcSaveSetBtn').addEventListener('click', saveGearSet);
    document.getElementById('tbcClearAllBtn').addEventListener('click', clearAllGear);
    document.getElementById('tbcShareSetBtn').addEventListener('click', shareGearSet);
    document.getElementById('tbcResetAllBtn').addEventListener('click', function() {
      if (confirm('Reset ALL data?')) {
        localStorage.removeItem('tbcGearBuilderState');
        localStorage.removeItem('tbcGearBuilderSets');
        location.reload();
      }
    });
  }

  function renderSpecSelection() {
    var specSection = document.getElementById('tbcSpecSection');
    var specGrid = document.getElementById('tbcSpecGrid');
    if (!state.selectedClass || !CLASS_SPECS[state.selectedClass]) { specSection.style.display = 'none'; return; }
    var specs = CLASS_SPECS[state.selectedClass];
    specSection.style.display = 'block';
    specGrid.innerHTML = specs.map(function(spec) {
      return '<div class="tbc-gb-spec-option' + (state.selectedSpec === spec.id ? ' selected' : '') + '" data-spec="' + spec.id + '"><img src="https://wow.zamimg.com/images/wow/icons/large/' + spec.icon + '" class="tbc-gb-spec-icon" alt="' + spec.name + '"><div class="tbc-gb-spec-name">' + spec.name + '</div>' + (spec.desc ? '<div class="tbc-gb-spec-desc">' + spec.desc + '</div>' : '') + '</div>';
    }).join('');
    document.querySelectorAll('.tbc-gb-spec-option').forEach(function(opt) {
      opt.addEventListener('click', function() {
        state.selectedSpec = this.dataset.spec;
        document.querySelectorAll('.tbc-gb-spec-option').forEach(function(o) { o.classList.remove('selected'); });
        this.classList.add('selected');
        document.getElementById('tbcProfessionSection').style.display = 'block';
        document.getElementById('tbcBuilderSection').style.display = 'block';
        updateCharacterDisplay();
        saveState();
      });
    });
  }

  function updateProfessionInfo() {
    var infoDiv = document.getElementById('tbcProfessionInfo');
    if (state.professions.length === 0) { infoDiv.style.display = 'none'; return; }
    var html = '';
    state.professions.forEach(function(prof) { if (PROFESSION_INFO[prof]) html += '<p>' + PROFESSION_INFO[prof] + '</p>'; });
    infoDiv.innerHTML = html;
    infoDiv.style.display = html ? 'block' : 'none';
  }

  function updateCharacterDisplay() {
    var classDisplay = document.getElementById('tbcCharClass');
    var specDisplay = document.getElementById('tbcCharSpec');
    var seasonDisplay = document.getElementById('tbcCharSeason');
    var profsDisplay = document.getElementById('tbcCharProfessions');
    var classIcon = document.getElementById('tbcCharClassIcon');
    if (state.selectedClass) {
      var className = state.selectedClass.charAt(0).toUpperCase() + state.selectedClass.slice(1);
      classDisplay.textContent = className;
      classDisplay.className = 'tbc-gb-char-class class-' + state.selectedClass;
      classIcon.src = CLASS_ICONS[state.selectedClass];
    } else {
      classDisplay.textContent = 'Select a Class';
      classDisplay.className = 'tbc-gb-char-class';
    }
    if (state.selectedSpec) {
      var specData = CLASS_SPECS[state.selectedClass] && CLASS_SPECS[state.selectedClass].find(function(s) { return s.id === state.selectedSpec; });
      specDisplay.textContent = specData ? specData.name : '';
    } else { specDisplay.textContent = ''; }
    seasonDisplay.textContent = SEASON_LABELS[state.season];
    profsDisplay.textContent = state.professions.length > 0 ? state.professions.map(function(p) { return p.charAt(0).toUpperCase() + p.slice(1); }).join(' / ') : '';
  }

  function openSlotModal(slot) {
    currentSlot = slot;
    document.getElementById('tbcModalTitle').textContent = 'Add Item - ' + SLOT_NAMES[slot];
    var item = state.gearData[slot] || {};
    document.getElementById('tbcItemIdInput').value = item.id || '';
    document.getElementById('tbcItemQualitySelect').value = item.quality || '4';
    document.getElementById('tbcMetaGem').value = item.metaGem || '';
    document.getElementById('tbcGem1').value = item.gem1 || '';
    document.getElementById('tbcGem2').value = item.gem2 || '';
    document.getElementById('tbcGem3').value = item.gem3 || '';
    document.getElementById('tbcEnchantInput').value = item.enchant || '';
    var showGems = GEM_SLOTS.indexOf(slot) !== -1;
    var showMeta = slot === 'head';
    var showEnchant = ENCHANTABLE_SLOTS.indexOf(slot) !== -1;
    document.getElementById('tbcGemSection').style.display = showGems ? 'block' : 'none';
    document.getElementById('tbcMetaGem').parentElement.style.display = showMeta ? 'block' : 'none';
    document.getElementById('tbcEnchantInput').parentElement.style.display = showEnchant ? 'block' : 'none';
    document.getElementById('tbcModalOverlay').classList.add('active');
    document.getElementById('tbcItemIdInput').focus();
  }

  function closeModal() {
    document.getElementById('tbcModalOverlay').classList.remove('active');
    currentSlot = null;
  }

  function parseItemId(input) {
    input = (input || '').trim();
    var urlMatch = input.match(/item=(\d+)/);
    if (urlMatch) return urlMatch[1];
    var numMatch = input.match(/^(\d+)$/);
    if (numMatch) return numMatch[1];
    return input;
  }

  function saveItem() {
    var input = document.getElementById('tbcItemIdInput').value;
    var itemId = parseItemId(input);
    var quality = document.getElementById('tbcItemQualitySelect').value;
    if (!itemId) { alert('Please enter a valid item ID'); return; }
    state.gearData[currentSlot] = {
      id: itemId,
      name: '',
      quality: quality,
      metaGem: parseItemId(document.getElementById('tbcMetaGem').value),
      gem1: parseItemId(document.getElementById('tbcGem1').value),
      gem2: parseItemId(document.getElementById('tbcGem2').value),
      gem3: parseItemId(document.getElementById('tbcGem3').value),
      enchant: parseItemId(document.getElementById('tbcEnchantInput').value)
    };
    updateSlotDisplay(currentSlot);
    closeModal();
    saveState();
    setTimeout(refreshWowheadTooltips, 100);
  }

  function removeItem() {
    if (currentSlot && state.gearData[currentSlot]) {
      delete state.gearData[currentSlot];
      updateSlotDisplay(currentSlot);
    }
    closeModal();
    saveState();
  }

  function updateSlotDisplay(slot) {
    var slotEl = document.querySelector('.tbc-gb-gear-slot[data-slot="' + slot + '"]');
    var nameEl = slotEl.querySelector('.tbc-gb-item-name');
    var iconEl = slotEl.querySelector('.tbc-gb-slot-icon');
    var extrasEl = slotEl.querySelector('.tbc-gb-slot-extras');
    if (state.gearData[slot]) {
      slotEl.classList.add('has-item');
      var item = state.gearData[slot];
      nameEl.innerHTML = '<a href="https://tbc.wowhead.com/item=' + item.id + '" data-wowhead="item=' + item.id + '&domain=tbc" target="_blank"></a>';
      nameEl.className = 'tbc-gb-item-name q' + item.quality;
      iconEl.innerHTML = '<a href="https://tbc.wowhead.com/item=' + item.id + '" data-wowhead="item=' + item.id + '&domain=tbc" target="_blank" class="tbc-gb-icon-link"></a>';
      var extras = [];
      if (item.metaGem) extras.push('<a href="https://tbc.wowhead.com/item=' + item.metaGem + '" data-wowhead="item=' + item.metaGem + '&domain=tbc" target="_blank"></a>');
      if (item.gem1) extras.push('<a href="https://tbc.wowhead.com/item=' + item.gem1 + '" data-wowhead="item=' + item.gem1 + '&domain=tbc" target="_blank"></a>');
      if (item.gem2) extras.push('<a href="https://tbc.wowhead.com/item=' + item.gem2 + '" data-wowhead="item=' + item.gem2 + '&domain=tbc" target="_blank"></a>');
      if (item.gem3) extras.push('<a href="https://tbc.wowhead.com/item=' + item.gem3 + '" data-wowhead="item=' + item.gem3 + '&domain=tbc" target="_blank"></a>');
      if (item.enchant) extras.push('<a href="https://tbc.wowhead.com/item=' + item.enchant + '" data-wowhead="item=' + item.enchant + '&domain=tbc" target="_blank" class="tbc-gb-enchant-text"></a>');
      extrasEl.innerHTML = extras.join(' ');
    } else {
      nameEl.textContent = 'Click to add item';
      nameEl.className = 'tbc-gb-item-name empty';
      slotEl.classList.remove('has-item');
      iconEl.innerHTML = '<span>' + SLOT_LABELS[slot] + '</span>';
      extrasEl.innerHTML = '';
    }
  }

  function refreshWowheadTooltips() {
    if (typeof $WowheadPower !== 'undefined' && $WowheadPower.refreshLinks) $WowheadPower.refreshLinks();
  }

  function clearAllGear() {
    if (confirm('Clear all gear slots?')) {
      state.gearData = {};
      document.querySelectorAll('.tbc-gb-gear-slot').forEach(function(slot) { updateSlotDisplay(slot.dataset.slot); });
      saveState();
    }
  }

  function saveGearSet() {
    var setName = document.getElementById('tbcSetNameInput').value.trim() || 'Unnamed Set';
    var setData = {name: setName, class: state.selectedClass, spec: state.selectedSpec, season: state.season, professions: state.professions.slice(), gear: JSON.parse(JSON.stringify(state.gearData)), timestamp: Date.now()};
    var savedSets = JSON.parse(localStorage.getItem('tbcGearBuilderSets') || '[]');
    savedSets.unshift(setData);
    savedSets = savedSets.slice(0, 20);
    localStorage.setItem('tbcGearBuilderSets', JSON.stringify(savedSets));
    renderSavedSets();
    alert('Gear set saved!');
  }

  function renderSavedSets() {
    var savedSets = JSON.parse(localStorage.getItem('tbcGearBuilderSets') || '[]');
    var container = document.getElementById('tbcSavedSetsList');
    if (savedSets.length === 0) { container.innerHTML = '<p class="tbc-gb-empty-message">No saved gear sets yet.</p>'; return; }
    container.innerHTML = savedSets.map(function(set, index) {
      return '<div class="tbc-gb-saved-item"><div class="tbc-gb-saved-info"><span class="tbc-gb-saved-name">' + set.name + '</span><span class="tbc-gb-saved-meta">' + (set.class || 'Unknown') + (set.spec ? ' (' + set.spec + ')' : '') + ' - ' + (SEASON_LABELS[set.season] || set.season) + '</span></div><div class="tbc-gb-saved-actions"><button class="tbc-gb-btn tbc-gb-btn-primary" onclick="window.tbcGearBuilder.loadSet(' + index + ')">LOAD</button><button class="tbc-gb-btn tbc-gb-btn-danger" onclick="window.tbcGearBuilder.deleteSet(' + index + ')">DELETE</button></div></div>';
    }).join('');
  }

  function loadSet(index) {
    var savedSets = JSON.parse(localStorage.getItem('tbcGearBuilderSets') || '[]');
    var set = savedSets[index];
    if (!set) return;
    state.selectedClass = set.class;
    state.selectedSpec = set.spec;
    state.season = set.season || 'preseason';
    state.professions = set.professions || [];
    state.gearData = set.gear || {};
    document.getElementById('tbcSetNameInput').value = set.name;
    document.querySelectorAll('.tbc-gb-season-btn').forEach(function(btn) { btn.classList.toggle('active', btn.dataset.season === state.season); });
    document.querySelectorAll('.tbc-gb-class-btn').forEach(function(btn) { btn.classList.toggle('selected', btn.dataset.class === state.selectedClass); });
    document.querySelectorAll('.tbc-gb-profession-option').forEach(function(opt) { opt.classList.toggle('selected', state.professions.indexOf(opt.dataset.profession) !== -1); });
    renderSpecSelection();
    if (state.selectedSpec) {
      setTimeout(function() {
        document.querySelectorAll('.tbc-gb-spec-option').forEach(function(opt) { opt.classList.toggle('selected', opt.dataset.spec === state.selectedSpec); });
        document.getElementById('tbcProfessionSection').style.display = 'block';
        document.getElementById('tbcBuilderSection').style.display = 'block';
      }, 50);
    }
    document.querySelectorAll('.tbc-gb-gear-slot').forEach(function(slot) { updateSlotDisplay(slot.dataset.slot); });
    updateProfessionInfo();
    updateCharacterDisplay();
    saveState();
    setTimeout(refreshWowheadTooltips, 100);
  }

  function deleteSet(index) {
    if (!confirm('Delete this gear set?')) return;
    var savedSets = JSON.parse(localStorage.getItem('tbcGearBuilderSets') || '[]');
    savedSets.splice(index, 1);
    localStorage.setItem('tbcGearBuilderSets', JSON.stringify(savedSets));
    renderSavedSets();
  }

  function shareGearSet() {
    var data = {c: state.selectedClass, sp: state.selectedSpec, se: state.season, pr: state.professions, g: state.gearData};
    var encoded = btoa(JSON.stringify(data));
    var url = window.location.origin + window.location.pathname + '?gearset=' + encoded;
    navigator.clipboard.writeText(url).then(function() { alert('Share link copied!'); }).catch(function() { prompt('Copy this link:', url); });
  }

  function loadFromURL() {
    var params = new URLSearchParams(window.location.search);
    var setParam = params.get('gearset');
    if (setParam) {
      try {
        var data = JSON.parse(atob(setParam));
        if (data.c) state.selectedClass = data.c;
        if (data.sp) state.selectedSpec = data.sp;
        if (data.se) state.season = data.se;
        if (data.pr) state.professions = data.pr;
        if (data.g) state.gearData = data.g;
      } catch (e) { console.error('Failed to load from URL:', e); }
    }
  }

  function saveState() {
    localStorage.setItem('tbcGearBuilderState', JSON.stringify(state));
    var indicator = document.getElementById('tbcAutosaveIndicator');
    if (indicator) { indicator.textContent = 'Saved'; setTimeout(function() { indicator.textContent = 'Auto-saved'; }, 1500); }
  }

  function loadState() {
    loadFromURL();
    var saved = localStorage.getItem('tbcGearBuilderState');
    if (saved) { try { var l = JSON.parse(saved); state = Object.assign({}, state, l); } catch (e) { console.error(e); } }
    document.querySelectorAll('.tbc-gb-season-btn').forEach(function(btn) { btn.classList.toggle('active', btn.dataset.season === state.season); });
    if (state.selectedClass) {
      document.querySelectorAll('.tbc-gb-class-btn').forEach(function(btn) { btn.classList.toggle('selected', btn.dataset.class === state.selectedClass); });
      renderSpecSelection();
      if (state.selectedSpec) {
        setTimeout(function() {
          document.querySelectorAll('.tbc-gb-spec-option').forEach(function(opt) { opt.classList.toggle('selected', opt.dataset.spec === state.selectedSpec); });
          document.getElementById('tbcProfessionSection').style.display = 'block';
          document.getElementById('tbcBuilderSection').style.display = 'block';
        }, 50);
      }
    }
    if (state.professions.length > 0) {
      document.querySelectorAll('.tbc-gb-profession-option').forEach(function(opt) { opt.classList.toggle('selected', state.professions.indexOf(opt.dataset.profession) !== -1); });
      updateProfessionInfo();
    }
    if (state.gearData && Object.keys(state.gearData).length > 0) {
      setTimeout(function() {
        document.querySelectorAll('.tbc-gb-gear-slot').forEach(function(slot) { updateSlotDisplay(slot.dataset.slot); });
        refreshWowheadTooltips();
      }, 100);
    }
  }

  window.tbcGearBuilder = {loadSet: loadSet, deleteSet: deleteSet};
  if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', init); } else { init(); }
})();
</script>

{% schema %}
{"name":"TBC Gear Builder","settings":[{"type":"text","id":"heading","label":"Heading","default":"TBC GEAR SET BUILDER"},{"type":"text","id":"subheading","label":"Subheading","default":"Plan your Burning Crusade gear sets with gems & enchants"}],"presets":[{"name":"TBC Gear Builder","category":"Custom"}]}
{% endschema %}
